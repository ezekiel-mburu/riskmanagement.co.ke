function hudumiaJirani($http,$q,$rootScope,TARAKILISHI){return{ulizaSwali:function(regno){var req={method:"POST",url:TARAKILISHI.JIRANI,headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{regno:regno}};return $http(req).then(function(response){return response.data})},ulizaDereva:function(idno){var req={method:"POST",url:TARAKILISHI.MADEREVA,headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{usahihino:idno}};return $http(req).then(function(response){return response.data})},ulizaMagari:function(pinno){var req={method:"POST",url:TARAKILISHI.MTUGARI,headers:{"Content-Type":"application/x-www-form-urlencoded"},params:{p:pinno}};return $http(req).then(function(response){return response.data})}}}function watuDb($http,$q,$rootScope,TARAKILISHI){var watuDb=this;watuDb.listOfWatus={},watuDb.getWatus=function(){var defer=$q.defer();return $http.get(TARAKILISHI.MARAFIKI).success(function(res){watuDb.listOfWatus=res,defer.resolve(res)}).error(function(err,status){defer.reject(err)}),defer.promise}}function authService($window,$location){var self=this;self.parseJwt=function(token){var base64Url=token.split(".")[1],base64=base64Url.replace("-","+").replace("_","/");return JSON.parse($window.atob(base64))},self.saveToken=function(token){self.localStorageSupported()?$window.localStorage.jwtToken=token:$window.localStorage.jwtToken=token},self.removeToken=function(token){self.localStorageSupported()&&$window.localStorage.removeItem("jwtToken")},self.getToken=function(){if(self.localStorageSupported())return $window.localStorage.jwtToken},self.isAuthed=function(){var token=self.getToken();if(token){var params=self.parseJwt(token);return Math.round((new Date).getTime()/1e3)<=params.exp}return!1},self.logout=function(){$window.localStorage.removeItem("jwtToken")},self.go=function(myUrl){$location.path(myUrl)},self.gStorageSupported=void 0,self.localStorageSupported=function(){if(void 0===self.gStorageSupported)try{$window.localStorage.setItem("test","1"),$window.localStorage.removeItem("test"),self.gStorageSupported=!0}catch(err){self.gStorageSupported=!1}return self.gStorageSupported}}function userService($http,TARAKILISHI,auth){return{ingia:function(jina,siri){var req={method:"POST",url:TARAKILISHI.WATCHIE,headers:{"Content-Type":void 0},params:{username:jina,password:siri}};return $http(req).then(function(response){return response.data})}}}function authInterceptor(auth,$location){return{request:function(config){var token=auth.getToken();return token?config.headers.Authorization="Bearer "+token:(config.headers.Authorization="Bearer Denied",auth.removeToken()),config},response:function(res){return res.data.token?(auth.saveToken(res.data.token),console.log("Mtunguiyaz ... hapo sawa ingia ba")):res.data.success===!1&&auth.removeToken(),res}}}function hudumiaTarakilishi($location){var host="www.sam.co.ke",serverPort=84,serverProtocol="http",serverUrl=serverProtocol+"://"+host+":"+serverPort;return{MTAA:serverUrl,JIRANI:serverUrl+"/ntsa",MARAFIKI:serverUrl+"/api/registeredUsers",WATCHIE:serverUrl+"/authenticate",MADEREVA:serverUrl+"/usahihi",MTUGARI:serverUrl+"/mtugari"}}function config($stateProvider,$urlRouterProvider,$ocLazyLoadProvider,$httpProvider){$urlRouterProvider.otherwise("anza"),$ocLazyLoadProvider.config({debug:!0}),$httpProvider.interceptors.push("authInterceptor"),$httpProvider.defaults.headers.common={},$httpProvider.defaults.headers.post={},$httpProvider.defaults.headers.put={},$httpProvider.defaults.headers.patch={},$stateProvider.state("index",{"abstract":!0,url:"/index",templateUrl:"views/common/content.html"}).state("index.main",{url:"/main",templateUrl:"views/main.html",data:{pageTitle:"Your Dashboard"}}).state("settings",{"abstract":!0,url:"/settings",templateUrl:"views/common/content.html"}).state("landing",{url:"/landing",templateUrl:"views/landing.html",data:{pageTitle:"Dashboard",specialClass:"landing-page"},resolve:{loadPlugin:function($ocLazyLoad){return $ocLazyLoad.load([{files:["bower_components/iCheck/skins/css/custom.css","bower_components/iCheck/icheck.min.js"]}])}}}).state("anza",{url:"/anza",templateUrl:"views/login.html",controller:"accessCtrl as mbwaKali",data:{pageTitle:"Login",specialClass:"blue-bg"}}).state("toka",{url:"/toka",templateUrl:"views/logout.html",controller:"accessCtrl as mbwaKali",data:{pageTitle:"Logged Out",specialClass:"gray-bg"}}).state("settings.users",{url:"/users",templateUrl:"views/users.html",controller:"watuCtrl as watu",data:{pageTitle:"Users"},resolve:{watuList:function(watuDb){return watuDb.getWatus()},loadPlugin:function($ocLazyLoad){return $ocLazyLoad.load([{files:["bower_components/footable/dist/footable.all.min.js","bower_components/footable/css/footable.core.css"]},{name:"ui.footable",files:["bower_components/angular-footable/dist/angular-footable.js"]}])}}}).state("index.dashboard",{url:"/dashboard",templateUrl:"views/dashboard.html",controller:"dashboardCtrl as chart",data:{pageTitle:"Dashboard"},resolve:{loadPlugin:function($ocLazyLoad){return $ocLazyLoad.load([{serie:!0,name:"angular-flot",files:["bower_components/flot/jquery.flot.js","bower_components/flot/jquery.flot.time.js","bower_components/flot.tooltip.pib/js/jquery.flot.tooltip.min.js","bower_components/jquery.flot.spline/index.js","bower_components/flot/jquery.flot.resize.js","bower_components/flot/jquery.flot.pie.js","bower_components/flot.curvedlines/curvedLines.js","bower_components/angular-flot/angular-flot.js"]},{files:["bower_components/jquery.sparkline/index.js"]}])}}}).state("logout",{url:"/logout",templateUrl:"views/logout.html",data:{pageTitle:"Logged Out",specialClass:"gray-bg"}}).state("index.underwrite",{url:"/underwrite",templateUrl:"views/underwrite.html",controller:"ulizaJirani as ulizaJirani",data:{pageTitle:"Loan Approval"}}).state("index.minor",{url:"/minor",templateUrl:"views/minor.html",data:{pageTitle:"My Profile"}}).state("widgets",{url:"/widgets",templateUrl:"views/dashboard.html",data:{pageTitle:"Widhets"},resolve:{loadPlugin:function($ocLazyLoad){return $ocLazyLoad.load([{files:["bower_components/iCheck/css/custom.css","bower_components/iCheck/icheck.min.js"]}])}}})}function pageTitle($rootScope,$timeout){return{link:function(scope,element){var listener=function(event,toState,toParams,fromState,fromParams){var title="NIC | Risk Based Financing";toState.data&&toState.data.pageTitle&&(title="NIC | RBF | "+toState.data.pageTitle),$timeout(function(){element.text(title)})};$rootScope.$on("$stateChangeStart",listener)}}}function sideNavigation($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.metisMenu()})}}}function responsiveVideo(){return{restrict:"A",link:function(scope,element){var figure=element,video=element.children();video.attr("data-aspectRatio",video.height()/video.width()).removeAttr("height").removeAttr("width"),$(window).resize(function(){var newWidth=figure.width();video.width(newWidth).height(newWidth*video.attr("data-aspectRatio"))}).resize()}}}function iboxTools($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.find("div.ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()}}}}function iboxToolsFullScreen($timeout){return{restrict:"A",scope:!0,templateUrl:"views/common/ibox_tools_full_screen.html",controller:function($scope,$element){$scope.showhide=function(){var ibox=$element.closest("div.ibox"),icon=$element.find("i:first"),content=ibox.find("div.ibox-content");content.slideToggle(200),icon.toggleClass("fa-chevron-up").toggleClass("fa-chevron-down"),ibox.toggleClass("").toggleClass("border-bottom"),$timeout(function(){ibox.resize(),ibox.find("[id^=map-]").resize()},50)},$scope.closebox=function(){var ibox=$element.closest("div.ibox");ibox.remove()},$scope.fullscreen=function(){var ibox=$element.closest("div.ibox"),button=$element.find("i.fa-expand");$("body").toggleClass("fullscreen-ibox-mode"),button.toggleClass("fa-expand").toggleClass("fa-compress"),ibox.toggleClass("fullscreen"),setTimeout(function(){$(window).trigger("resize")},100)}}}}function minimalizaSidebar($timeout){return{restrict:"A",template:'<a class="navbar-minimalize minimalize-styl-2 btn btn-primary " href="" ng-click="minimalize()"><i class="fa fa-bars"></i></a>',controller:function($scope,$element){$scope.minimalize=function(){$("body").toggleClass("mini-navbar"),!$("body").hasClass("mini-navbar")||$("body").hasClass("body-small")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},200)):$("body").hasClass("fixed-sidebar")?($("#side-menu").hide(),setTimeout(function(){$("#side-menu").fadeIn(400)},100)):$("#side-menu").removeAttr("style")}}}}function closeOffCanvas(){return{restrict:"A",template:'<a class="close-canvas-menu" ng-click="closeOffCanvas()"><i class="fa fa-times"></i></a>',controller:function($scope,$element){$scope.closeOffCanvas=function(){$("body").toggleClass("mini-navbar")}}}}function vectorMap(){return{restrict:"A",scope:{myMapData:"="},link:function(scope,element,attrs){element.vectorMap({map:"world_mill_en",backgroundColor:"transparent",regionStyle:{initial:{fill:"#e4e4e4","fill-opacity":.9,stroke:"none","stroke-width":0,"stroke-opacity":0}},series:{regions:[{values:scope.myMapData,scale:["#1ab394","#22d6b1"],normalizeFunction:"polynomial"}]}})}}}function sparkline(){return{restrict:"A",scope:{sparkData:"=",sparkOptions:"="},link:function(scope,element,attrs){scope.$watch(scope.sparkData,function(){render()}),scope.$watch(scope.sparkOptions,function(){render()});var render=function(){$(element).sparkline(scope.sparkData,scope.sparkOptions)}}}}function icheck($timeout){return{restrict:"A",require:"ngModel",link:function($scope,element,$attrs,ngModel){return $timeout(function(){var value;return value=$attrs.value,$scope.$watch($attrs.ngModel,function(newValue){$(element).iCheck("update")}),$(element).iCheck({checkboxClass:"icheckbox_square-green",radioClass:"iradio_square-green"}).on("ifChanged",function(event){if("checkbox"===$(element).attr("type")&&$attrs.ngModel&&$scope.$apply(function(){return ngModel.$setViewValue(event.target.checked)}),"radio"===$(element).attr("type")&&$attrs.ngModel)return $scope.$apply(function(){return ngModel.$setViewValue(value)})})})}}}function ionRangeSlider(){return{restrict:"A",scope:{rangeOptions:"="},link:function(scope,elem,attrs){elem.ionRangeSlider(scope.rangeOptions)}}}function dropZone(){return function(scope,element,attrs){element.dropzone({url:"/upload",maxFilesize:100,paramName:"uploadfile",maxThumbnailFilesize:5,init:function(){scope.files.push({file:"added"}),this.on("success",function(file,json){}),this.on("addedfile",function(file){scope.$apply(function(){alert(file),scope.files.push({file:"added"})})}),this.on("drop",function(file){alert("file")})}})}}function chatSlimScroll($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.slimscroll({height:"234px",railOpacity:.4})})}}}function customValid(){return{require:"ngModel",link:function(scope,ele,attrs,c){scope.$watch(attrs.ngModel,function(){var validText="riskmanagementapp";scope.extras==validText?c.$setValidity("cvalid",!0):c.$setValidity("cvalid",!1)})}}}function fullScroll($timeout){return{restrict:"A",link:function(scope,element){$timeout(function(){element.slimscroll({height:"100%",railOpacity:.9})})}}}function slimScroll($timeout){return{restrict:"A",scope:{boxHeight:"@"},link:function(scope,element){$timeout(function(){element.slimscroll({height:scope.boxHeight,railOpacity:.9})})}}}function clockPicker(){return{restrict:"A",link:function(scope,element){element.clockpicker()}}}function landingScrollspy(){return{restrict:"A",link:function(scope,element,attrs){element.scrollspy({target:".navbar-fixed-top",offset:80})}}}function fitHeight(){return{restrict:"A",link:function(scope,element){element.css("height",$(window).height()+"px"),element.css("min-height",$(window).height()+"px")}}}function truncate($timeout){return{restrict:"A",scope:{truncateOptions:"="},link:function(scope,element){$timeout(function(){element.dotdotdot(scope.truncateOptions)})}}}function touchSpin(){return{restrict:"A",scope:{spinOptions:"="},link:function(scope,element,attrs){scope.$watch(scope.spinOptions,function(){render()});var render=function(){$(element).TouchSpin(scope.spinOptions)}}}}function markdownEditor(){return{restrict:"A",require:"ngModel",link:function(scope,element,attrs,ngModel){$(element).markdown({savable:!1,onChange:function(e){ngModel.$setViewValue(e.getContent())}})}}}function accessCtrl(user,auth,$state,$scope){function handleRequest(res){var token=res.token?res.token:null;if(token){self.message=res.message;var goUrl="index.underwrite";$state.go(goUrl)}else self.message=res.message}var self=this;self.ingia=function(){user.ingia(self.jina,self.siri).then(handleRequest,handleRequest)},self.toka=function(){auth.logout&&auth.logout()},self.isAuthed=function(){return!!auth.isAuthed&&auth.isAuthed()}}function MainCtrl(){this.userName="NIC Bank Staff",this.helloText="Welcome in riskmanagement.co.ke",this.descriptionText="Your risk based financing portal"}function dashboardCtrl(){var data1=[[0,4],[1,8],[2,5],[3,10],[4,4],[5,16],[6,5],[7,11],[8,6],[9,11],[10,20],[11,10],[12,13],[13,4],[14,7],[15,8],[16,12]],data2=[[0,0],[1,2],[2,7],[3,4],[4,11],[5,4],[6,2],[7,5],[8,11],[9,5],[10,4],[11,1],[12,5],[13,2],[14,5],[15,2],[16,0]],options={series:{lines:{show:!1,fill:!0},splines:{show:!0,tension:.4,lineWidth:1,fill:.4},points:{radius:0,show:!0},shadowSize:2},grid:{hoverable:!0,clickable:!0,borderWidth:2,color:"transparent"},colors:["#1ab394","#1C84C6"],xaxis:{},yaxis:{},tooltip:!1};this.flotData=[data1,data2],this.flotOptions=options;var sparkline1Data=[34,43,43,35,44,32,44,52],sparkline1Options={type:"line",width:"100%",height:"50",lineColor:"#1ab394",fillColor:"transparent"},sparkline2Data=[32,11,25,37,41,32,34,42],sparkline2Options={type:"line",width:"100%",height:"50",lineColor:"#1ab394",fillColor:"transparent"};this.sparkline1=sparkline1Data,this.sparkline1Options=sparkline1Options,this.sparkline2=sparkline2Data,this.sparkline2Options=sparkline2Options}function ulizaJirani(hudumiaJirani,$scope){var self=this;self.status=0,self.magariZake=[],self.magariZakeRegNo=[],self.magariZakeOwners=[],self.mambo="",self.madereva="",self.OtherCarsOwned=0,self.TotalCarsOwned=0,self.carAgeAtReg=0,self.clearMagari=function($scope){self.mambo=""},self.clearMadereva=function($scope){self.madereva=""},self.clearVariableUsed=function($scope){self.status=0,self.magariZake=[],self.magariZakeRegNo=[],self.magariZakeOwners=[],self.OtherCarsOwned=0,self.TotalCarsOwned=0,self.carAgeAtReg=0},self.clearEveryone=function($scope){self.clearMagari(),self.clearMadereva(),self.clearVariableUsed()},self.kilamtu=function(){self.clearEveryone(),self.habari(self.regno),self.maderevaje()},self.habari=function(myRegNo){hudumiaJirani.ulizaSwali(myRegNo).then(function(res){self.mambo=res,self.status=1;var carRegDate=Date.parse(self.mambo.vehicle.registrationDate),carManufactureYear=Number(self.mambo.vehicle.yearOfManufacture)+.5;for(carManufactureYear<30?carManufactureYear+=2e3:carManufactureYear<100?carManufactureYear+=1900:carManufactureYear=carManufactureYear,self.carRegYear=carRegDate/31536e6+1970,self.carAgeAtReg=self.carRegYear-carManufactureYear,i=0;i<self.mambo.owner.length;i++)self.thisOwnerPin=self.mambo.owner[i].PIN,"A"==self.thisOwnerPin.charAt(0)&&(console.log(self.thisOwnerPin),self.magariZakeJe(self.thisOwnerPin))})["catch"](function(fallback){console.log("CATCHME")});self.loadingPage=1},self.maderevaje=function(){hudumiaJirani.ulizaDereva(self.idno).then(function(res){self.madereva=res,self.status=1})["catch"](function(fallback){console.log("CATCHME")})},self.magariZakeJe=function(thisOwnerPin){hudumiaJirani.ulizaMagari(thisOwnerPin).then(function(res){for(self.magariZake=res,self.status=1,self.TotalCarsOwned=self.magariZake.length,self.OtherCarsOwned=self.TotalCarsOwned-1,console.log(self.magariZake),console.log("Count of cars "+self.magariZake.length),i=0;i<self.magariZake.length;i++){var thisCarChassis=self.magariZake[i];console.log(thisCarChassis),console.log(i);hudumiaJirani.ulizaSwali(thisCarChassis).then(function(res){console.log(res);var thisCarOwners="";for(j=0;j<res.owner.length;j++){var ownernames=[res.owner[j].NAME,"",res.owner[j].FIRSTNAME," ",res.owner[j].MIDDLENAME," ",res.owner[j].LASTNAME].join("");thisCarOwners=0==j?ownernames:thisCarOwners+", "+ownernames}return self.magariZakeRegNo.push(res.regNo),self.magariZakeOwners.push(thisCarOwners.toString()),console.log(self.magariZakeRegNo),console.log(self.magariZakeOwners),res})["catch"](function(fallback){console.log("CATCHME - Could not Add all vehicles")})}})["catch"](function(fallback){console.log("CATCHME")})}}function watuCtrl(watuList){this.watuList=watuList}function serverDetails(location){var host="www.sam.co.ke",serverPort=84,serverProtocol="http",serverUrl=serverProtocol+"://"+host+":"+serverPort;return console.log(serverUrl),{MTAA:serverUrl,JIRANI:serverUrl+"/ntsa",MARAFIKI:serverUrl+"/api/registeredUsers",WATCHIE:serverUrl+"/authenticate"}}$(document).ready(function(){function fix_height(){var heightWithoutNavbar=$("body > #wrapper").height()-61;$(".sidebard-panel").css("min-height",heightWithoutNavbar+"px");var navbarHeigh=$("nav.navbar-default").height(),wrapperHeigh=$("#page-wrapper").height();navbarHeigh>wrapperHeigh&&$("#page-wrapper").css("min-height",navbarHeigh+"px"),navbarHeigh<wrapperHeigh&&$("#page-wrapper").css("min-height",$(window).height()+"px"),$("body").hasClass("fixed-nav")&&(navbarHeigh>wrapperHeigh?$("#page-wrapper").css("min-height",navbarHeigh-60+"px"):$("#page-wrapper").css("min-height",$(window).height()-60+"px"))}$("body").addClass("skin-2"),$(window).bind("load resize scroll",function(){$("body").hasClass("body-small")||fix_height()}),setTimeout(function(){fix_height()})}),$(function(){$(window).bind("load resize",function(){$(this).width()<769?$("body").addClass("body-small"):$("body").removeClass("body-small")})}),function(){angular.module("riskmanagementapp",["ui.router","oc.lazyLoad","ui.bootstrap"])}(),angular.module("riskmanagementapp").factory("authInterceptor",authInterceptor).service("user",userService).service("auth",authService).service("hudumiaJirani",hudumiaJirani).service("watuDb",watuDb).factory("TARAKILISHI",hudumiaTarakilishi),angular.module("riskmanagementapp").config(config).run(function($rootScope,$location,$state,auth){$rootScope.$state=$state,$rootScope.$on("$stateChangeStart",function(e,toState,toParams,fromState,fromParams){var isLogin="anza"===toState.name;if(!isLogin){auth.isAuthed()}})}),angular.module("riskmanagementapp").directive("pageTitle",pageTitle).directive("sideNavigation",sideNavigation).directive("iboxTools",iboxTools).directive("minimalizaSidebar",minimalizaSidebar).directive("vectorMap",vectorMap).directive("sparkline",sparkline).directive("icheck",icheck).directive("ionRangeSlider",ionRangeSlider).directive("dropZone",dropZone).directive("chatSlimScroll",chatSlimScroll).directive("customValid",customValid).directive("fullScroll",fullScroll).directive("closeOffCanvas",closeOffCanvas).directive("clockPicker",clockPicker).directive("landingScrollspy",landingScrollspy).directive("fitHeight",fitHeight).directive("iboxToolsFullScreen",iboxToolsFullScreen).directive("slimScroll",slimScroll).directive("truncate",truncate).directive("touchSpin",touchSpin).directive("markdownEditor",markdownEditor),angular.module("riskmanagementapp").controller("accessCtrl",accessCtrl).controller("MainCtrl",MainCtrl).controller("dashboardCtrl",dashboardCtrl).controller("ulizaJirani",ulizaJirani).controller("watuCtrl",watuCtrl);